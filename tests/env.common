# Common test harness environment
if [ -z "$HARNESS_DIR" ]; then
  HARNESS_DIR=$(CDPATH= cd -- "$(dirname "$0")" 2>/dev/null && pwd)
fi
# If sourced from tests/scripts adjust up one level so we find mocks/
if [ ! -d "$HARNESS_DIR/mocks" ] && [ -d "$HARNESS_DIR/../mocks" ]; then
  HARNESS_DIR=$(CDPATH= cd -- "$HARNESS_DIR/.." && pwd)
fi
MOCK_DIR="$HARNESS_DIR/mocks"
SCENARIO_DIR="$HARNESS_DIR/scenarios"
LOG_FILE="$HARNESS_DIR/test.log"
STATE_DIR="$HARNESS_DIR/state"
PATH="$MOCK_DIR:$PATH"
export HARNESS_DIR MOCK_DIR SCENARIO_DIR LOG_FILE STATE_DIR PATH
mkdir -p "$STATE_DIR"
touch "$LOG_FILE"

# Utility: load scenario file exporting needed variables
load_scenario() {
  . "$SCENARIO"/env 2>/dev/null || return 0
}
